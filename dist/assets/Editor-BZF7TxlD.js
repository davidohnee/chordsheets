import{d as ee,u as se,o as l,e as c,J as re,H as de,i as h,K as ue,x as me,y as pe,c as d,a as t,b as T,k as _,h as p,F as f,r as x,l as y,p as K,g as v,f as b,t as u,z as ve,n as ge,v as M,m as ce,_ as fe}from"./main-c0_bQcCc.js";import{E as ye}from"./dom-to-image-CkUaIQJ9.js";import{d as O}from"./vuedraggable.umd-Bh1_f6WQ.js";import{a as Y,i as R,E as Z}from"./Editor-C0B_bQTW.js";import{S as F}from"./Song--aOc_pzz.js";/* empty css                                                               */const ke=ee({__name:"SongSearcher",emits:["select"],setup(te,{emit:k}){const D=se(),V=k,A=w=>D.songs.filter(m=>JSON.stringify({title:m.title,artist:m.artist,bpm:m.bpm,key:m.key}).toLowerCase().includes(w.toLowerCase())).map(m=>({id:m.id,title:m.title,subtitle:m.artist,img:m.cover,action:()=>{V("select",m)}}));return(w,m)=>(l(),c(re,{search:A}))}}),we={class:"page-title"},Se={class:"items"},he={class:"container"},be={class:"section-checks"},_e=["title"],Ce={title:"Pages"},De={class:"duration",title:"Estimated duration (1 song = 4 minutes)"},Ve=["onClick"],Ae=["onClick"],Ee={key:0,class:"preview"},Pe={class:"toolbar"},$e={class:"content"},Te={key:0},xe={key:0},Me={key:2},Ne={key:3},Le={class:"insights"},Ue={class:"container"},Be={class:"container"},Ke={class:"container"},Oe={class:"container"},Re={class:"container"},Fe={class:"container warning"},Ie={class:"muted"},Je={class:"content"},je={class:"preview-container"},He={class:"preview scale-sm"},ze={class:"row"},We=["value","max"],qe=ee({__name:"Editor",setup(te){const k=se(),D=de(),V=ve(),A=ge(),w=h(),m=h(),S=h(-1),E=M(()=>k.songs.filter(n=>!a.value.sections.some(e=>e.songs.some(o=>o.id===n.id)))),C=M(()=>k.songs.filter(n=>a.value.sections.some(e=>e.songs.some(o=>o.id===n.id))));if(V.params.id==="new"){const{id:n}=D.addEmptySetlist();A.push({path:`/setlist/${n}`,replace:!0})}const I=async()=>{m.value?.showModal();let n=new ye({orientation:"portrait",unit:"px",format:"a4"});S.value=0;const e=w.value??[];for(const[o,s]of e.entries())await s.renderTo(n),S.value++,o<e.length-1&&n.addPage();return m.value?.close(),S.value=-1,n},J=async()=>{const n=await I();n.autoPrint(),n.output("dataurlnewwindow")},j=async()=>{(await I()).save(a.value.name+".pdf")},H=async()=>{const n=a.value.sections.map(i=>({type:"setlist",...i,songs:i.songs.map(r=>$(r))})),e={...a.value,sections:n},o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),s=document.createElement("a");s.setAttribute("href",o),s.setAttribute("download",`${a.value.name}.chordsheets.json`),document.body.appendChild(s),s.click(),s.remove()},a=h(D.setlist(Number(V.params.id))||{type:"setlist",id:-1,name:"",sections:[]}),P=h(a.value.sections.map(n=>n.songs.map(()=>1))),ne=()=>{P.value.push([]),a.value.sections.push({id:new Date().getTime(),name:"Section "+(a.value.sections.length+1),songs:[]})},N=h(null),$=n=>"title"in n?n:k.songs.find(e=>e.id===n.id),z=n=>{N.value=null},L=n=>{const e=[],o=new Set;return n.songs.forEach(s=>{o.has(s.id)?e.push($(s)):o.add(s.id)}),e},W=n=>a.value.sections[n].songs.map((e,o)=>P.value[n]?.[o]??0).reduce((e,o)=>e+o,0),q=n=>{const e=n,o=Math.floor(e/60);return o===0?`${e}m`:`${o}h ${e%60}m`},G=n=>n.songs.reduce((e,o)=>e+4,0),oe=()=>a.value.sections.reduce((n,e)=>n+G(e),0)+(a.value.sections.length-1)*15,Q=n=>q(G(n)),le=M(()=>Array.from(a.value.sections.flatMap(e=>e.songs).reduce((e,o)=>(e.set(o.id,(e.get(o.id)??0)+1),e),new Map).entries()).filter(([e,o])=>o>1).map(([e,o])=>({song:k.songs.find(s=>s.id===e),count:o}))),ae=M(()=>a.value.sections.some(n=>n.songs.length));ue(()=>{a.value.id===-1&&A.push("/")});const X=n=>{n.ctrlKey&&n.key==="s"?(n.preventDefault(),H()):n.ctrlKey&&n.shiftKey&&n.key==="S"?(n.preventDefault(),j()):n.ctrlKey&&n.key==="p"&&(n.preventDefault(),n.stopImmediatePropagation(),J())},g=h("preview");return me(()=>{document.addEventListener("click",z),window.addEventListener("keydown",X)}),pe(()=>{document.removeEventListener("click",z),window.removeEventListener("keydown",X)}),(n,e)=>{const o=ce("router-link");return l(),d("div",{class:"browser",onDragover:e[12]||(e[12]=y(()=>{},["stop"]))},[t("div",{class:"editor",onDragstart:e[3]||(e[3]=y(()=>{},["stop"])),onDragover:e[4]||(e[4]=y(()=>{},["stop"]))},[t("h1",we,[T(o,{class:"link-on-hover",to:"/setlists"},{default:_(()=>[...e[13]||(e[13]=[p(" Setlists ",-1)])]),_:1}),e[14]||(e[14]=p(" / ",-1)),T(Y,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.name=s),placeholder:"Setlist name"},{default:_(()=>[p(u(a.value.name),1)]),_:1},8,["modelValue"])]),t("div",Se,[(l(!0),d(f,null,x(a.value.sections,(s,i)=>(l(),d("div",he,[t("h2",null,[T(Y,{class:"section-name",modelValue:s.name,"onUpdate:modelValue":r=>s.name=r,placeholder:"Section name"},{default:_(()=>[p(u(s.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),t("div",be,[L(s).length?(l(),d("div",{key:0,class:"duplicates",title:`Duplicates: ${L(s).map(r=>r.title).join(", ")}`},[e[15]||(e[15]=t("span",{class:"material-symbols-rounded"}," warning ",-1)),p(" "+u(L(s).length)+" Duplicates ",1)],8,_e)):v("",!0),t("div",null,[e[16]||(e[16]=t("span",{class:"material-symbols-rounded"}," music_note ",-1)),p(" "+u(s.songs.length)+" Songs ",1)]),t("div",Ce,[e[17]||(e[17]=t("span",{class:"material-symbols-rounded"}," book ",-1)),p(" "+u(W(i))+" Pages ",1)]),t("div",De,[e[18]||(e[18]=t("span",{class:"material-symbols-rounded"}," schedule ",-1)),p(" about "+u(Q(s)),1)]),t("div",{title:"Delete Section",class:"delete-section",onClick:r=>a.value.sections.splice(i,1)},[...e[19]||(e[19]=[t("span",{class:"material-symbols-rounded"}," delete ",-1),p(" Delete Section ",-1)])],8,Ve)]),T(b(O),{modelValue:s.songs,"onUpdate:modelValue":r=>s.songs=r,class:"songs","item-key":"id",onDragover:e[1]||(e[1]=y(()=>{},["stop"])),disabled:b(R)(),group:"songs"},{item:_(({element:r})=>[(l(),c(F,{key:r.id,song:$(r),"allow-delete":"",onDelete:U=>s.songs.splice(s.songs.indexOf(r),1)},null,8,["song","onDelete"]))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),t("div",{class:"info add-song",onClick:y(r=>N.value=i,["stop"])},[N.value===i?(l(),c(ke,{key:0,onClick:e[2]||(e[2]=y(()=>{},["stop"])),onSelect:r=>s.songs.push(r)},null,8,["onSelect"])):(l(),d(f,{key:1},[e[20]||(e[20]=t("span",{class:"material-symbols-rounded"}," add ",-1)),e[21]||(e[21]=p(" Add Song ",-1))],64))],8,Ae)]))),256)),t("div",{class:"info add-song",onClick:ne},[...e[22]||(e[22]=[t("span",{class:"material-symbols-rounded"}," add ",-1),p(" Add Section ",-1)])])])],32),ae.value?(l(),d("div",Ee,[t("div",Pe,[t("span",{class:"material-symbols-rounded",onClick:J,title:"Print (Ctrl+P)"}," print "),t("span",{class:"material-symbols-rounded",onClick:j,title:"Download as PDF (CTRL+SHIFT+S)"}," picture_as_pdf "),t("span",{class:"material-symbols-rounded",onClick:H,title:"Download as JSON (CTRL+S)"}," file_download "),e[23]||(e[23]=t("div",{class:"divider"},null,-1)),t("span",{class:K(["material-symbols-rounded",{active:g.value==="preview"}]),onClick:e[5]||(e[5]=s=>g.value="preview"),title:"Insights"}," preview ",2),t("span",{class:K(["material-symbols-rounded",{active:g.value==="add"}]),onClick:e[6]||(e[6]=s=>g.value="add"),title:"Add songs"}," playlist_add ",2),t("span",{class:K(["material-symbols-rounded",{active:g.value==="insights"}]),onClick:e[7]||(e[7]=s=>g.value="insights"),title:"Insights"}," insights ",2)]),t("div",$e,[g.value=="preview"?(l(!0),d(f,{key:0},x(a.value.sections,(s,i)=>(l(),d(f,null,[i>0?(l(),d("hr",Te)):v("",!0),t("h2",null,u(s.name),1),(l(!0),d(f,null,x(s.songs,(r,U)=>(l(),c(Z,{ref_for:!0,ref_key:"allPages",ref:w,printing:"",song:$(r),onOnPageCount:B=>P.value[i][U]=B,"page-offset":P.value[i].slice(0,U).reduce((B,ie)=>B+ie,0),"section-name":s.name,"disable-hotkeys":""},null,8,["song","onOnPageCount","page-offset","section-name"]))),256))],64))),256)):g.value=="add"?(l(),d(f,{key:1},[E.value.length?(l(),d("h2",xe,"Add new songs")):v("",!0),E.value.length?(l(),c(b(O),{key:1,modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=s=>E.value=s),class:"songs","item-key":"id",onDragover:e[9]||(e[9]=y(()=>{},["stop"])),group:"songs",disabled:b(R)()},{item:_(({element:s})=>[(l(),c(F,{key:s.id,song:s},null,8,["song"]))]),_:1},8,["modelValue","disabled"])):v("",!0),C.value.length?(l(),d("hr",Me)):v("",!0),C.value.length?(l(),d("h2",Ne,"Add songs again")):v("",!0),C.value.length?(l(),c(b(O),{key:4,modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=s=>C.value=s),class:"songs","item-key":"id",onDragover:e[11]||(e[11]=y(()=>{},["stop"])),group:"songs",disabled:b(R)()},{item:_(({element:s})=>[(l(),c(F,{key:s.id,song:s},null,8,["song"]))]),_:1},8,["modelValue","disabled"])):v("",!0)],64)):g.value=="insights"?(l(),d(f,{key:2},[e[29]||(e[29]=t("h2",null,"Insights",-1)),t("div",Le,[t("div",Ue,[t("h3",null,u(a.value.sections.length),1),e[24]||(e[24]=t("span",{class:"muted"},"Sections",-1))]),t("div",Be,[t("h3",null,u(a.value.sections.map(s=>s.songs.length).reduce((s,i)=>s+i,0)),1),e[25]||(e[25]=t("span",{class:"muted"},"Songs",-1))]),t("div",Ke,[t("h3",null,u(a.value.sections.map((s,i)=>W(i)).reduce((s,i)=>s+i,0)),1),e[26]||(e[26]=t("span",{class:"muted"},"Pages",-1))]),t("div",Oe,[t("h3",null,u(Q({songs:a.value.sections.flatMap(s=>s.songs)})),1),e[27]||(e[27]=t("span",{class:"muted"},"of playing time",-1))]),t("div",Re,[t("h3",null,u(q(oe())),1),e[28]||(e[28]=t("span",{class:"muted"},"including breaks",-1))]),(l(!0),d(f,null,x(le.value,s=>(l(),d("div",Fe,[t("h3",null,u(s.song.title),1),t("span",Ie," Duplicated "+u(s.count)+" times ",1)]))),256))])],64)):v("",!0)])])):v("",!0),t("dialog",{ref_key:"renderDialog",ref:m},[t("div",Je,[t("div",je,[t("div",He,[S.value>=0?(l(),c(Z,{key:0,printing:"",song:b(k).songs[S.value]},null,8,["song"])):v("",!0)])]),e[30]||(e[30]=t("h2",null,"Rendering...",-1)),e[31]||(e[31]=t("p",null," Please wait while we render your chord sheets. This may take a while. ",-1)),t("div",ze,[t("progress",{value:S.value,max:w.value?.length},null,8,We),t("p",null,[t("span",null,u(S.value),1),p(" / "+u(w.value?.length),1)])])])],512)],32)}}}),ss=fe(qe,[["__scopeId","data-v-0d47fa52"]]);export{ss as default};

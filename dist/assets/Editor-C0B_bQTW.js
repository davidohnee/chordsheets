import{d as G,i as B,s as L,x as _,w as se,c as m,l as $,p as I,G as ee,B as ne,L as le,M as Q,v as ae,o as r,A as z,_ as te,e as F,k as f,u as de,y as ie,F as N,r as K,a,b as y,t as p,h as V,g as C,f as W,N as Y}from"./main-c0_bQcCc.js";import{d as Z}from"./vuedraggable.umd-Bh1_f6WQ.js";/* empty css                                                               */import{d as re,E as ue}from"./dom-to-image-CkUaIQJ9.js";const ce=["placeholder"],me=G({__name:"EditableText",props:{modelValue:{type:String,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:x}){const E=o,d=B(E.modelValue);L(()=>E.modelValue,M=>d.value=M);const v=B(!1),S=x,s=B(null),h=()=>{E.locked||(v.value=!0,z(()=>{s.value&&s.value.focus()}))},D=ae(()=>E.locked?!0:v.value?!1:d.value||d.value=="0"),T=M=>{d.value=M,S("change",M),S("update:modelValue",M)},O=()=>{s.value&&(s.value.style.height="auto",s.value.style.height=s.value.scrollHeight+"px")};return _(()=>O()),se(()=>{v.value&&O()}),(M,g)=>(r(),m("div",{class:I(["editable-text",{outlined:!o.noOutline&&v.value,editing:v.value}]),onDblclick:$(h,["stop"])},[D.value?ee(M.$slots,"default",{key:0},void 0,!0):ne((r(),m("input",{key:1,ref_key:"area",ref:s,type:"text",class:"textarea","onUpdate:modelValue":g[0]||(g[0]=b=>d.value=b),onChange:g[1]||(g[1]=b=>T(b.target.value)),onInput:g[2]||(g[2]=b=>O()),onClick:g[3]||(g[3]=$(b=>v.value=!0,["stop"])),onKeydown:[g[4]||(g[4]=Q(b=>v.value=!1,["enter"])),g[5]||(g[5]=Q(b=>v.value=!1,["esc"]))],onBlur:g[6]||(g[6]=b=>v.value=!1),placeholder:o.placeholder},null,40,ce)),[[le,d.value]])],34))}}),U=te(me,[["__scopeId","data-v-446ef99f"]]),R=G({__name:"EditableNumber",props:{modelValue:{type:Number,required:!0},locked:{type:Boolean,default:!1},noOutline:{type:Boolean,default:!1},placeholder:{type:String,default:"Click to edit"}},emits:["update:modelValue","change"],setup(o,{emit:x}){const E=o,d=B(String(E.modelValue));L(()=>E.modelValue,s=>d.value=String(s));const v=x,S=s=>{const h=Number(s);d.value=s,v("change",h),v("update:modelValue",h)};return(s,h)=>(r(),F(U,{modelValue:d.value,"onUpdate:modelValue":h[0]||(h[0]=D=>d.value=D),onChange:S,"no-outline":o.noOutline,locked:o.locked,placeholder:o.placeholder},{default:f(()=>[ee(s.$slots,"default")]),_:3},8,["modelValue","no-outline","locked","placeholder"]))}}),q=()=>window.innerWidth<=800,pe={class:"editor__header"},ge={class:"wrap-to-line"},fe={class:"info"},ve={class:"info"},ke={class:"info"},ye={class:"material-symbols-rounded"},he={class:"info"},Ve={class:"capitalise"},be=["onClick"],we={key:0},Ce={class:"instruments"},Ue={class:"instrument"},$e=["onClick"],Ee={class:"flex space-between"},Me={class:"flex gap-2"},Se={class:"settings"},Pe={class:"muted"},Be=["id"],Ne={class:"name"},xe={key:0,class:"buttons"},De=["onClick"],Oe=["onClick"],He={key:1,class:"progression"},Ke=["onClick"],Le=["id","onMousedown","onMouseup"],Te=["onClick"],We=["id"],ze={class:"name"},Ae={class:"progression"},Re=["id"],qe={key:4,class:"pageNumber"},Ie={key:5,class:"sectionName"},Fe=G({__name:"Editor",props:{song:{type:Object,required:!0},printing:{type:Boolean,default:!1},pageOffset:{type:Number,default:0},sectionName:{type:String,required:!1},disableHotkeys:{type:Boolean,default:!1}},emits:["onPageCount"],setup(o,{expose:x,emit:E}){const d=o,v=de(),S=B(!1),s=B(d.printing),h=B(),D=(n,e)=>{const u=d.song.sections[n].progression[e],t={chord:u.chord,duration:u.duration};d.song.sections[n].progression.splice(e+1,0,t)},T=n=>{if(!d.disableHotkeys){if(n.key==="Delete")for(const e of d.song.sections)e.progression=e.progression.filter(i=>!i.selected);if(n.ctrlKey&&(n.key==="d"||n.key==="b")){n.preventDefault();for(const e of d.song.sections){const i=e.progression.filter(u=>u.selected);e.progression.splice(e.progression.indexOf(i[i.length-1])+1,0,...i.map(u=>({chord:u.chord,duration:u.duration,selected:!0}))),i.forEach(u=>u.selected=!1)}}n.ctrlKey&&n.key==="p"&&(n.preventDefault(),oe())}},O=(n,e)=>{if(e.button===2||q())return;const i=e.target;if(e.offsetX>i.clientWidth-10){e.preventDefault(),e.stopImmediatePropagation(),S.value=!0;const u=i.getBoundingClientRect().width/n.duration;let t=0;const c=k=>{const w=k.clientX-i.getBoundingClientRect().left;t=Math.round(w/u),n.duration=Math.max(1,Math.min(16,t))},l=k=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",l),S.value=!1,k.stopImmediatePropagation()};window.addEventListener("mousemove",c),window.addEventListener("mouseup",l)}},M=(n,e)=>{let i=n.selected;if(!e.shiftKey)for(const u of d.song.sections)for(const t of u.progression)t.selected=!1;n.selected=!i},g=n=>{d.song.sections.splice(n,1)},b=n=>{const e=d.song.sections[n],i={type:e.type,progression:e.progression.map(u=>({chord:u.chord,duration:u.duration})),page:0};d.song.sections.splice(n+1,0,i)},J=async n=>{const e=h.value.querySelectorAll(".editor");let i=e[0];const u=i.clientHeight/i.clientWidth;for(let l=0;l<e.length;l++){if(i=e[l],!i)continue;var t=n.internal.pageSize.getWidth(),c=n.internal.pageSize.getHeight();const k=2,w=await re.toJpeg(i,{height:i.clientHeight*k,width:i.clientWidth*k,style:{transform:`scale(${k}) translate(${i.clientWidth/2/k}px, ${i.clientHeight/2/k}px)`}});c=u*t,n.addImage(w,"JPG",0,0,t,c),l+1<e.length&&n.addPage()}return n};let X;const j=async()=>{s.value=!0,d.song.sections.length&&!d.printing&&await new Promise(i=>{X=i});const n=new ue({orientation:"portrait",unit:"px",format:"a4"});return await J(n),s.value=d.printing,n},oe=async()=>{await v.prepareRender();const n=await j();n&&(n.autoPrint(),window.open(n.output("bloburl"),"_blank"))};_(()=>{window.addEventListener("keydown",T),H()}),ie(()=>{window.removeEventListener("keydown",T)});const P=B([]),H=()=>{if(d.song.sections.length==0){P.value=[{start:0,end:0}],A("onPageCount",1);return}if(!s.value||P.value.length==0){P.value=[{start:0,end:d.song.sections.length}],s.value&&d.song.sections.length>0&&z(H),A("onPageCount",1);return}const n=h.value.querySelectorAll(".section");if(n.length==0)return;const e=n[0].parentElement,i=getComputedStyle(e),u=e.clientHeight-parseFloat(i.paddingBottom);for(let t=0;t<n.length;t++){const c=n[t];if(c.offsetTop+c.offsetHeight>u){P.value[P.value.length-1].end=t,P.value.push({start:t,end:d.song.sections.length}),z(H);return}}A("onPageCount",P.value.length),X?.()};L(()=>d.song,H,{deep:!0}),L(s,()=>z(H)),L(()=>d.printing,()=>{s.value=d.printing}),x({renderTo:J,render:j,name:()=>d.song.title});const A=E;return(n,e)=>(r(),m("div",{ref_key:"parent",ref:h,class:"pageWrapper"},[(r(!0),m(N,null,K(P.value,(i,u)=>(r(),m("div",{class:I(["editor",{resizing:S.value,print:s.value}]),onDragover:e[14]||(e[14]=$(()=>{},["prevent"]))},[u==0?(r(),m(N,{key:0},[a("div",pe,[y(U,{locked:s.value,modelValue:o.song.artist,"onUpdate:modelValue":e[0]||(e[0]=t=>o.song.artist=t),class:"left",placeholder:"Click to edit artist name","no-outline":""},{default:f(()=>[a("h3",null,p(o.song.artist),1)]),_:1},8,["locked","modelValue"]),y(U,{locked:s.value,modelValue:o.song.title,"onUpdate:modelValue":e[1]||(e[1]=t=>o.song.title=t),class:"left h1",placeholder:"Click to edit song title","no-outline":""},{default:f(()=>[a("h1",null,p(o.song.title),1)]),_:1},8,["locked","modelValue"])]),a("div",ge,[a("div",fe,[e[15]||(e[15]=a("span",{class:"material-symbols-rounded"},"music_note",-1)),y(R,{locked:s.value,modelValue:o.song.bpm,"onUpdate:modelValue":e[2]||(e[2]=t=>o.song.bpm=t),class:"left short",placeholder:"120"},{default:f(()=>[V(p(o.song.bpm),1)]),_:1},8,["locked","modelValue"]),e[16]||(e[16]=V(" BPM ",-1))]),a("div",ve,[e[17]||(e[17]=a("span",{class:"material-symbols-rounded"},"piano",-1)),y(U,{locked:s.value,modelValue:o.song.key,"onUpdate:modelValue":e[3]||(e[3]=t=>o.song.key=t),class:"left short",placeholder:"C"},{default:f(()=>[V(p(o.song.key),1)]),_:1},8,["locked","modelValue"])]),a("div",ke,[a("span",ye,p(o.song.transpose>0?"arrow_upward":o.song.transpose<0?"arrow_downward":"drag_handle"),1),y(R,{locked:s.value,modelValue:o.song.transpose,"onUpdate:modelValue":e[4]||(e[4]=t=>o.song.transpose=t),class:"left short",placeholder:"0"},{default:f(()=>[V(p(o.song.transpose),1)]),_:1},8,["locked","modelValue"])]),o.song.options?(r(!0),m(N,{key:0},K(o.song.options,(t,c)=>(r(),m("div",he,[e[18]||(e[18]=a("span",{class:"material-symbols-rounded"}," check ",-1)),y(U,{locked:s.value,modelValue:o.song.options[c],"onUpdate:modelValue":l=>o.song.options[c]=l,class:"left",placeholder:"Option"},{default:f(()=>[a("span",Ve,p(t),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?C("",!0):(r(),m("span",{key:0,onClick:l=>o.song.options.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,be))]))),256)):C("",!0),a("div",{class:"info add-option",onClick:e[5]||(e[5]=t=>o.song.options?o.song.options.push("Sustain"):o.song.options=["Sustain"])},[...e[19]||(e[19]=[a("span",{class:"material-symbols-rounded"}," add ",-1),V(" Add Option ",-1)])])]),o.song.instruments?.length?(r(),m("hr",we)):C("",!0),a("div",Ce,[(r(!0),m(N,null,K(o.song.instruments,(t,c)=>(r(),m("div",Ue,[s.value?C("",!0):(r(),m("span",{key:0,onClick:l=>o.song.instruments.splice(c,1),class:"delete material-symbols-rounded"}," delete ",8,$e)),a("div",Ee,[y(U,{locked:s.value,modelValue:t.for,"onUpdate:modelValue":l=>t.for=l,class:"left short",placeholder:"Click to edit instrument","no-outline":""},{default:f(()=>[a("span",null,p(t.for),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),a("span",Me,[e[20]||(e[20]=a("span",{class:"material-symbols-rounded"}," volume_up ",-1)),y(R,{locked:s.value,modelValue:t.volume,"onUpdate:modelValue":l=>t.volume=l,class:"left short",placeholder:"100"},{default:f(()=>[V(p(t?.volume),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])]),a("div",Se,[y(U,{locked:s.value,modelValue:t.name,"onUpdate:modelValue":l=>t.name=l,class:"left h3",placeholder:"Click to edit instrument name","no-outline":""},{default:f(()=>[a("h3",null,p(t.name),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),a("span",Pe,[y(U,{locked:s.value,modelValue:t.type,"onUpdate:modelValue":l=>t.type=l,class:"left",placeholder:"Click to edit instrument type","no-outline":""},{default:f(()=>[V(p(t?.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"])])])]))),256)),a("div",{class:"instrument add-option",onClick:e[6]||(e[6]=t=>o.song.instruments.push({name:"ConcertGrand",for:"R1",type:"Piano",volume:100}))},[...e[21]||(e[21]=[a("span",{class:"material-symbols-rounded"}," add ",-1),V(" Add Instrument ",-1)])])]),e[22]||(e[22]=a("hr",null,null,-1))],64)):C("",!0),s.value?(r(!0),m(N,{key:2},K(d.song.sections.slice(i.start,i.end),(t,c)=>(r(),m("div",{class:"section printable",id:`section-${c}`},[a("span",ze,p(t.type),1),a("div",Ae,[(r(!0),m(N,null,K(t.progression,(l,k)=>(r(),m("div",{class:"chord",ref_for:!0,ref:"chordElements",id:`chord-${c}-${k}`,style:Y({"--cols":l.duration})},p(l.chord),13,Re))),256))])],8,We))),256)):(r(),F(W(Z),{key:1,modelValue:o.song.sections,"onUpdate:modelValue":e[11]||(e[11]=t=>o.song.sections=t),class:"editor__content",onDragover:e[12]||(e[12]=$(()=>{},["stop"])),itemKey:"id",disabled:W(q)()},{item:f(({element:t,index:c})=>[a("div",{class:"section",id:`section-${c}`},[y(U,{locked:s.value,modelValue:t.type,"onUpdate:modelValue":l=>t.type=l,class:"left",placeholder:"Click to edit section name","no-outline":""},{default:f(()=>[a("span",Ne,p(t.type),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?C("",!0):(r(),m("div",xe,[a("span",{class:"button material-symbols-rounded",onClick:l=>b(c)}," content_copy ",8,De),a("span",{class:"button material-symbols-rounded",onClick:l=>g(c)}," delete ",8,Oe)])),t.progression.length===0?(r(),m("div",He,[a("div",{class:"chord create",style:{"--cols":4},onClick:$(l=>t.progression.push({chord:"C",duration:4}),["stop"])},[...e[23]||(e[23]=[a("span",{class:"material-symbols-rounded"}," add ",-1),V(" Add Chord ",-1)])],8,Ke)])):(r(),F(W(Z),{key:2,modelValue:t.progression,"onUpdate:modelValue":l=>t.progression=l,class:"progression",onDragover:e[10]||(e[10]=$(()=>{},["stop"])),itemKey:"id",disabled:W(q)()},{item:f(({element:l,index:k})=>[a("div",{class:I(["chord",l.selected?" selected":""]),ref_for:!0,ref:"chordElements",id:`chord-${c}-${k}`,onMousedown:w=>O(l,w),onMouseup:w=>M(l,w),onClick:e[9]||(e[9]=$(()=>{},["stop"])),style:Y({"--cols":l.duration})},[y(U,{locked:s.value,modelValue:l.chord,"onUpdate:modelValue":w=>l.chord=w,"no-outline":"",placeholder:"C"},{default:f(()=>[V(p(l.chord),1)]),_:2},1032,["locked","modelValue","onUpdate:modelValue"]),s.value?C("",!0):(r(),m("span",{key:0,class:"insert_chord_here",onMousedown:e[7]||(e[7]=$(()=>{},["stop"])),onMouseup:e[8]||(e[8]=$(()=>{},["stop"])),onClick:$(w=>D(c,k),["stop"])},null,40,Te))],46,Le)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]))],8,Be)]),_:2},1032,["modelValue","disabled"])),s.value?C("",!0):(r(),m("div",{key:3,class:"add-section",id:"add-section",onClick:e[13]||(e[13]=t=>o.song.sections.push({type:"New Section",progression:[]}))},[...e[24]||(e[24]=[a("span",{class:"material-symbols-rounded"}," add ",-1),V(" Add Section ",-1)])])),s.value?(r(),m("span",qe,p(u+o.pageOffset+1),1)):C("",!0),s.value&&o.sectionName?(r(),m("span",Ie,p(o.sectionName),1)):C("",!0)],34))),256))],512))}}),Qe=te(Fe,[["__scopeId","data-v-42308af4"]]);export{Qe as E,U as a,q as i};
